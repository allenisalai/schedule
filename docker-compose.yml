version: '3.7'
services:
  frontend:
    build:
      context: .
      target: frontend
    volumes:
      - ./fe:/angular-app
      - /angular-app/node_modules
    command: ["build-dev"]
  backend:
    build:
      context: .
      target: backend
    ports:
      - 80:8080
    environment:
      - FRONTEND_DIST_DIR=/fe-dist/dist
      - DATABASE_URL=postgres://postgres:docker@db:5432/postgres?sslmode=disable
      - FIREBASE_CREDENTIALS=ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiYWxhaS1hYmEiLAogICJwcml2YXRlX2tleV9pZCI6ICI5NDEwMjM2ZjAwOTQ3M2E2NzUwNmY1YmVmODRjOGI0NWVhODIzZWExIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdndJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLa3dnZ1NsQWdFQUFvSUJBUUNqK2xDbkJ4SnBwdTk2XG5SWFZ4SVkrSm9wYlNnT1JXQ2NpT0QyTHhLNTJKRy9VWU5kdmRCRGpQZW9aUVZNSmNEZGh4K0owd3hjTGVsc05jXG5EMkFDRE9GemRlbTFqYnIwamwrU0JLSS83NTk5MGxMbjhwWmQwNC9oMTZudUJTQlZHYXlvNzZ5S0FyZUpXNkl0XG5aSlV2Y3NVaTk1QTNxVklwUWp1ZHJhMDFqRmtRc2pJR29PTU0rb0pjdHRVQUtDVEhKWUJVdDZtaEhRNERNR0tqXG5peitjWUZUTk5YbVBvTVVXT1Q0OUxSZmx4YWNUU05EU0Jjc1d2MElkdWRsWElrWHdMWE5pck5sL3VDMEl6RmtzXG4zbUxJQkVTSDUzTnIyYS92NVNKa1pQRHUrek11elF0OWcrdUdPa1VVRndpcEtVTENFdW1rajRpUElIY2F2Y2xLXG5ndWpZRFB3dkFnTUJBQUVDZ2dFQUY1U056VHgwRzdpdUpCRjIrUVRRSlFVUGdVZnR1S2hXMXk3dWxkWFFKVlpkXG5qQ29QNnZHS0pkNllaVmJsb3VLTzBmSTVlemtGSG9pTzlyUnpUdmdyNGpSVG5tVzZPODdPMUNyOGEyQ2tZOWlVXG5wQ3c3WS85aUVuZTJtbUY4Vm5YY1lXZ2pQSzdLcStML0tGM3RkM3hKVGJwTXIrUnJ5ZWthQ2tFSkc4azBudlRMXG5UakVSSmxwenZSUllrbDBFWFNyRHl4T00wQTduNEhHOUhSWGx2dmtiUkh2KzRlTW4zamUwZGN3RzB1ajBVempwXG54SUNDVjVOc08zWVo0bXlzSEtJUHNFK20rUDdzZDhwOWp2WTdsbzBOUElyTVZiajB0RUVTNXBPdmlLNnVMaXdCXG41blFLZGdtRnRjSmJGRTlVVU5vMlRXMWtCKzYyY0dwWnpnUkNNY2swdVFLQmdRRGVSUko4OCs1b2xXbVdsTElZXG5GL1pVUENFRWVlZ21tb0VBVjllUDRvUjcvN0tYZWVHbysxNEpzbjNBY09rc1BqYm9nNkR4YnVQa3d0ZThINElxXG5PTnNJYUwrMUN1WWx5dkRaR2htcWJCRnJPNnBaZFd5RlN5dWp5Q0dTMUZwUFN4Y0hjRVkwLzc1TDY3cWY5dlpOXG5VbVIzTGdTVU1wbVo0UzA2cDV3RlcwYnNOUUtCZ1FDODNLb2gvS20yRUd5WFYvV3VZbzFKWFdBejlxZVU5M0RmXG54MTUxMWFhNTZSN2RpdkJZblpSb1AzSkFiR0lWTGt2YlpHWHA4VXUvQjZVQkpKUGNhRU1CM3FVS3k5SFJCWU1PXG5CTWFXckVnVGhVeTNBQVF4d1RCc0ZjNE5zczJLd3FFcFF6ZU1sUmxMV1BJdllYTEVkdFJLZ1laNEdNS2g0d0kyXG5tUWZjRWd1clV3S0JnUUNKOWNtQjhVNWJiOUgzK3hlSHlPZkdaUVFCYVVGbEpLVkpkengvUEpRSyt5ejR4RmdDXG5zUE12aGJCMEVDRktxdHNkK3dXY2xiMnlNaFlCMkhUTWpEbTN3SHl0ZkxSWlpOdVZoWlBFcWdzdHlmejBSZVF6XG4zL0tZV0JJdXRzdlBSOFpsZ1pTeU5NTURFSy9udGp3dXhpTkJyamg5VytMbkZsTWlnd0plZU1kT3VRS0JnUUMxXG5LWEtsY1drVjlNRkZsNkZhYXJ5ZWdFeDA3QWdxZEFTNUU5US9jZmNoWkVZd08wTjdyWVNiVHlqNE5UOE1sRUU5XG5yUnU1Z2JXb0E5dzZzV3lJUXhicnB6ZG5tTVdtSEFSdm9STWhteGIwYXF5QTZpb2IwL1h2NkNha3F6eFErNHQrXG5PalVCekUvY0gvRUlsQkJ6OW95Qy82WU9jNm5YZ2hzd1pqRE00QjZEY3dLQmdRQ3ZKSW5kbytDbTYwMGFHZnNOXG5DMW10SitwdWV0azJSbFVDK24reVJ2bE1LSnZkbmpzRWV2b1JCRlpIRFYrVFFSTFpYelo5UVI4MVFKSTVsQnM1XG5FOFBRMC9GNXJqYlE0eElVbjVGWDg2SVNLMjNIaUtVZCtzVjAwYmhRN01oQi9XZ0RwY2g0S21VWWVwYTJKRXhyXG5hMGRWZDZjZ3RldGd5NGpxVWZxN0NmMzc3dz09XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstZWlseGdAYWxhaS1hYmEuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTE2NzU4NTYwNjEyMTg3MzAyNzcwIiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9maXJlYmFzZS1hZG1pbnNkay1laWx4ZyU0MGFsYWktYWJhLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cgo=
    volumes:
      - ./fe:/fe-dist/
      - ./app:/go-app
    command: ["--watch=./", "--bin-name=app"]
  db:
    image: postgres:10.7-alpine
    container_name: db
    environment:
      POSTGRES_PASSWORD: docker